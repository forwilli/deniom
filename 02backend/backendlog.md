# Deniom 后端 - 开发日志

本文档以功能为单位，跟踪 Deniom 后端 API 的开发进展。它作为项目已实现功能、关键架构决策和系统状态的高级技术摘要。

---

## `[2025-07-01]` Feature 14: 生产级三步筛选流程完整执行 & 顶级项目发现

### 状态: 🚀 重大成果 - 完美实战验证

-   **背景**: 在V13深度评估模型成功部署后，今天首次进行了完整的、端到端的三步筛选流程实战测试，处理2025-06-30的真实GitHub项目数据，验证整个分析管道的生产级性能和AI评估质量。

-   **完整流程执行结果**:
    
    | 阶段 | 处理数量 | 通过数量 | 通过率 | 使用模型 |
    |------|----------|----------|--------|----------|
    | **第一步：统一筛选** | 189个 | 57个 | 30.2% | gemini-2.5-flash-lite |
    | **第二步：核心想法筛选** | 57个 | 30个 | 52.6% | gemini-2.5-flash-lite |
    | **第三步：V13深度评估** | 30个 | 22个 | 73.3% | gemini-2.5-pro |

-   **🏆 顶级项目发现**:
    -   **5个DIAMOND级钻石项目**：
        - `MeiGen-AI/PosterCraft` (8.5分) - AI海报生成技术突破
        - `WW-AI-Lab/Awesome-MCP-Scaffold` (8.4分) - MCP服务器开发脚手架
        - `GZWSAMA/One-2-3-Pose` (8.2分) - 单图6D位姿估计技术
        - `eu90h/semantic-dictionary` (8.2分) - Python语义字典库
        - `eleven-am/db-migrator` (8.1分) - Go数据库迁移工具
        
    -   **17个HIDDEN GEM级璞玉项目**，包括：
        - `wehos/Xiao8` (8.0分) - AI虚拟伙伴
        - `Sharpiless/L2M` (8.0分) - 计算机视觉特征匹配
        - `LibAFLstar/LibAFLstar` (8.0分) - 网络协议模糊测试工具
        - 等等...

-   **🔍 深度案例分析**:
    以**eu90h/semantic-dictionary** (DIAMOND, 8.2分)为例：
    -   **用户需求洞察** (8.5分): 精准解决AI/NLP开发中语义模糊匹配痛点
    -   **差异化优势** (9.0分): 完美复用Python原生dict接口，学习成本为零
    -   **病毒传播潜力** (7.0分): 在开发者社群中具备"Wow Moment"传播效应
    -   **核心价值**: 将复杂的向量搜索封装成`sd['key']`般简洁的接口

-   **✅ 系统性能验证**:
    -   **网络稳定性**: 全程无API调用失败，代理配置完美工作
    -   **AI质量一致性**: V13模型在22个项目上表现出色，分析深度和准确性显著
    -   **数据保护机制**: 成功保留所有历史分析数据，无数据丢失
    -   **处理效率**: 整个流程在约3分钟内完成，符合生产级性能要求

-   **🧪 V13模型额外验证**:
    对用户的"小猫补光灯App"想法进行了专门测试：
    -   **最终得分**: 8.0分 - HIDDEN GEM (璞玉)
    -   **关键洞察**: AI开发背景提供独特传播优势，"非程序员用AI开发App"成为现象级营销素材
    -   **传播潜力**: 8.5分 - 具备从技术圈破圈到大众用户的病毒传播基因

-   **🎯 数据修复与优化**:
    -   **评估逻辑BUG修复**: 修正了判断条件，确保DIAMOND/HIDDEN GEM项目正确通过筛选
    -   **数据保护增强**: 优化删除逻辑，仅清理SCREENING阶段数据，保护所有已分析项目
    -   **临时文件清理**: 移除所有调试用临时文件，保持代码库整洁

-   **系统状态**: 🌟 **Deniom后端已完全进入生产就绪状态！** 三步筛选管道经过实战验证，能够稳定、高效地从大量GitHub项目中发现和评估具有商业价值和创新潜力的顶级项目。AI评估质量达到专业投资分析师水准，为后续的市场分析和投资决策提供了坚实的技术基础。

---

## `[2025-01-01]` Feature 13: 网络连接问题彻底解决 & V13深度评估模型成功部署

### 状态: ✅ 重大突破 - 生产就绪

-   **背景**: 经历了长期的网络连接困扰，V12深度评估模型虽然设计完善，但由于`google-generativeai==0.7.1`库的代理支持问题，一直无法在代理环境下正常工作。这个技术障碍严重阻碍了整个分析管道的实际运行。

-   **关键突破**:
    -   **🔧 技术栈升级**: 彻底废弃了有代理支持缺陷的`google-generativeai==0.7.1`，升级到官方推荐的新库`google-genai==1.23.0`，该库具有原生的、稳定的代理支持能力。
    -   **🌐 代理配置重构**: 抛弃了复杂的HttpOptions配置方式，采用更简洁可靠的环境变量方法：
        ```python
        if settings.https_proxy:
            os.environ['HTTPS_PROXY'] = settings.https_proxy
            os.environ['HTTP_PROXY'] = settings.https_proxy
        ```
    -   **⚡ Token配置优化**: 解决了`gemini-2.5-pro`模型的thinking模式导致的token溢出问题：
        - `thinking_budget=1000` - 限制思考过程的token消耗
        - `max_output_tokens=8192` - 确保足够的输出空间
        - 保持thinking模式以利用模型的最强推理能力
    -   **🎯 V13评估框架演进**: 从V12的"商业/可行/独特"三维升级到更精准的"产品-社群-传播"框架：
        1. **产品适配度 (Product-Market Fit)**: 产品与真实需求的匹配程度
        2. **社群建构力 (Community Building Power)**: 是否能形成忠实用户社群  
        3. **病毒传播潜质 (Viral Potential)**: 目标用户群体的传播意愿和能力

-   **验证成果**:
    -   **网络连接完全正常**: `>>> [DEBUG] Gemini API 调用成功`
    -   **V13模型成功运行**: 对"小猫补光灯App"给出了**8.0分**的精准评估，评级为**"HIDDEN GEM (璞玉)"**
    -   **深度分析质量优异**: 提供了1378字符的详细中文分析，包含具体的市场洞察和传播策略建议
    -   **系统稳定性验证**: 30秒超时机制和重试逻辑确保了高可用性

-   **核心技术细节: V13评估框架 Prompt (产品-社群-传播模型)**
    ```
    **V13 深度评估指令："产品-社群-传播"三维突破模型**

    **角色**: 你是全球顶级的早期项目评估专家，专精于识别具有突破性潜力的创新项目。
    **评估维度**:
    1. **产品适配度 (Product-Market Fit)**: 它是否解决了一个真实、强烈、具体的用户痛点？
    2. **社群建构力 (Community Building Power)**: 它是否能够围绕自己形成一个活跃、忠诚的用户社群？  
    3. **病毒传播潜质 (Viral Potential)**: 它的目标用户群体是否具有较高的传播意愿和能力？

    **评分标准**: 
    - 9-10分：突破性的，可能改变整个行业
    - 7-8分：优秀的，具有明显竞争优势
    - 5-6分：中等的，有一定潜力但存在明显缺陷
    - 3-4分：较弱的，缺乏关键成功要素
    - 1-2分：极差的，基本没有成功可能

    **输出格式 (严格JSON)**:
    {
      "detailed_analysis": {
        "product_market_fit": { "score": <float>, "reasoning": "<详细分析>" },
        "community_building_power": { "score": <float>, "reasoning": "<详细分析>" },
        "viral_potential": { "score": <float>, "reasoning": "<详细分析>" }
      },
      "overall_assessment": {
        "final_score": <float>,
        "recommendation": "<DIAMOND | HIDDEN GEM | SOLID BET | RISKY PLAY | PASS>",
        "summary": "<综合评估总结>"
      }
    }
    ```

-   **系统状态**: 🚀 **网络问题彻底解决，V13深度评估模型完全就绪！** 分析管道现在可以稳定运行，为高质量的项目评估提供强大的AI分析能力。这标志着Deniom后端从技术验证阶段正式进入生产应用阶段。

---

## `[2025-06-30]` Feature 12: 深度评估模型V12.0 - 从"成败模式"到"商业/可行/独特"三维筛选

### 状态: ✅ 核心功能实现

-   **背景**: 在引入"核心想法筛选"层后，我们意识到原有的V10.0"成败模式识别"框架对于一个筛选阶段来说，依然过于复杂和耗时。我们需要一个更严格、更聚焦、更具决定性的最终评估模型，来守住进入市场分析阶段的大门。

-   **关键成就**:
    -   **V12.0 三维深度筛选模型**: 彻底取代了V10.0框架，设计并实现了一个全新的深度评估逻辑。该模型强制要求项目必须同时满足三个非此即彼的核心维度才能通过：
        1.  **商业潜力 (has_commercial_potential)**: 是否存在具有强烈付费意愿的清晰用户群体？
        2.  **实现可行性 (is_feasible)**: 是否能被构建成一个稳定、可靠的产品？
        3.  **独特性/病毒性 (has_unique_advantage)**: 是否拥有一个难以复制的、可能引发疯狂传播的优点？
    -   **双模型AI架构**: 对AI客户端进行了重构，以支持多模型策略。筛选阶段使用快速的 `gemini-2.5-flash-lite-preview-06-17` 模型 [[memory:261123881561869823]]，而此关键的深度评估阶段则指定使用更强大的 **`gemini-2.5-pro`** 模型。
    -   **模型鲁棒性验证**: 通过对"小猫补光灯app"这个极具迷惑性的想法进行实战测试，V12.0模型成功给出了拒绝的判断，其理由是"核心功能已被手机原生免费功能替代，缺乏商业潜力和独特性"，这证明了新模型能够穿透表面创意，识别出深刻的商业模式缺陷，其判断力甚至优于初步的人类直觉。

-   **系统状态**: 深度评估阶段（`EVALUATION`）现已成为分析管道中一道极其严格的"窄门"，确保了只有在商业、产品、市场三个层面都达到卓越标准的极少数项目，才有资格消耗资源进入后续的市场分析。

---

## `[2025-06-30]` Feature 11: 引入"核心想法"定性筛选层

### 状态: ✅ 核心功能实现

-   **背景**: 在实现了高效的初步筛选后，我们发现从"有效项目"到"V10深度评估"之间仍然存在巨大的鸿沟。直接对所有通过初筛的项目进行深度分析，成本过高且效率低下。我们需要一个中间层来评估想法本身的"品质"。

-   **关键成就**:
    -   **新增"核心想法筛选"阶段**: 在分析管道中，于"统一筛选"和"深度评估"之间，正式插入了一个新的**`CORE_IDEA_FILTERING`**阶段。
    -   **四维定性评估模型**: 设计并实现了一个全新的AI评估Prompt，它不再关注商业化潜力，而是聚焦于想法的四个内在核心特质：
        1.  **真实痛点 (is_painkiller)**: 是否解决强需求？
        2.  **绝对新颖 (is_novel)**: 是否具备独创性？
        3.  **病毒潜力 (has_viral_potential)**: 是否内在地易于传播？
        4.  **极简优雅 (is_simple_and_elegant)**: 是否可能做到惊人地好用？
    -   **"四满足二"通过规则**: 明确规定，一个项目必须在上述四个维度中**至少满足两点**，才能被认为具备足够的"想法品质"，从而进入最终的深度评估阶段。
    -   **数据库与服务层支持**: 对 `Project` 模型、`AnalysisClient`、`ProjectAnalysisService` 和 `run_cli.py` 进行了全面的、支持新阶段的重构。

-   **系统状态**: 分析管道现已演进为一个更加成熟和精细化的三层漏斗（**初步筛选 -> 核心想法筛选 -> 深度评估**），能够以更高的成本效益，将分析资源精确地投入到那些不仅有效、并且核心理念闪光的项目上。

---

## `[2025-06-30]` Feature 10: 筛选管道重构与生产化

### 状态: ✅ 核心功能实现

-   **背景**: 在大规模数据测试后，我们发现最初的两步筛选法（初步过滤+信号过滤）存在流程冗余，并且AI评估标准不够聚焦。我们需要一个更精简、更严谨、更符合生产环境要求的数据入口。

-   **关键成就**:
    -   **统一筛选流程 (Unified Screening)**: 废除了原有的两阶段筛选，将其合并为一个单一、高效的筛选阶段。这大大简化了状态管理和业务逻辑。
    -   **数据源精确化**:
        -   **时间控制**: 实现了按指定自然日（北京时间 00:00 至 23:59）获取数据，取代了原先模糊的"过去24小时"逻辑，保证了数据处理的可追溯性和可重复性。
        -   **质量门槛**: 在API层面直接过滤掉 `星标 <= 2` 的项目，从源头提升了输入数据的质量。
    -   **AI模型优化**:
        -   **模型指定**: 明确筛选阶段使用 `gemini-2.5-flash-lite-preview-06-17` 模型 [[memory:261123881561869823]]，将最先进的模型用于最关键的入口评估。
        -   **Prompt重构**: 设计了全新的统一筛选Prompt，该指令要求AI同时完成"垃圾项目过滤"和"核心信号分析"（问题价值+商业潜力），使评估更高效、更聚焦。
    -   **数据存储生产化**:
        -   **批次化管理**: 在 `Project` 模型中引入 `batch_date` 字段，所有新获取的数据都与特定日期绑定，实现了数据按日隔离。
        -   **幂等性操作**: 每次运行特定日期的筛选时，系统会先自动删除该日期的所有旧数据，再存入新获取的数据，确保了数据批次的一致性和可覆盖性。

-   **系统状态**: 筛选管道现已升级为一个健壮、精确、可重复的生产级数据处理流程，能够为后续的深度评估阶段提供高质量、标准化的项目候选池。

---

## `[2025-06-30]` Feature 9: 评估体系的终极进化：从"思想品质"到"成败模式识别"

### 状态: ✅ 核心功能实现

-   **背景**: 在V7.0评估模型的基础上，用户提出了更深刻的挑战：模型虽然能够进行多维度分析，但在面对真正有缺陷的想法时，仍然表现得过于"宽容"，无法给出旗帜鲜明的"差评"；同时，在面对真正可能爆火的非典型想法（如"小猫补光灯"）时，也无法准确预测其"非理性"的成功潜力。

-   **关键成就**:
    -   **引入对抗性思维**: 为了解决"鉴伪"能力不足的问题，设计并引入了V8.0的**"红蓝对抗"**机制。该机制强制AI从"梦想家"（蓝队）和"清醒者"（红队）两个对立的视角进行内部辩论，极大地提升了评估的批判性和深度。
    -   **建立历史模式匹配**: 为了解决"预测"能力不足的问题，在V8.0的基础上，最终进化到了V10.0的**"成败双向模式匹配"**框架。该框架要求AI不仅仅是辩论，更是要成为一个"创新历史模式识别引擎"，将当前的想法与历史上著名的成功案例（如Twitter）和失败案例（如Juicero）进行模式匹配，从而对想法的未来轨迹做出更接近真相的预测。
    -   **根本性认知修正**: 在最终测试中，明确了对"小猫补光灯"这一关键案例的认知错误（从错误的"宠物硬件"概念修正为正确的"手机补光App"事实），并基于正确的事实，使用V10.0模型得到了最终的、令人满意的深度评估报告。

-   **核心技术细节: V10.0 "成败模式识别"终极框架 Prompt**
    ```
    **V10.0 深度评估指令："成败模式识别"终极框架**

    **角色**: 你是"创新历史模式识别引擎"。你学习了人类历史上所有成功和失败的产品案例。你的核心任务是，通过将当前想法与历史上的成败模式进行双向匹配，来预测其最可能的未来轨迹。
    **核心理念**: 伟大的想法常常在诞生初期看起来像个坏主意，但更多的坏主意真的就只是坏主意。我们必须同时识别"成功的信号"和"失败的信号"。

    **评估框架：四步对抗性元分析**
    1.  **红蓝对抗**: 采集正反两方论据 (The Bull Case vs. The Bear Case)。
    2.  **正面模式匹配 (寻找成功信号)**:
        *   与成功案例（如Twitter, Airbnb）的历史相似性。
        *   是否具备"聪明的玩具"特征。
        *   "红队"攻击的"不合理"之处，是否可能构成其非理性价值。
    3.  **负面模式匹配 (寻找失败信号)**:
        *   与失败案例（如Juicero, Google Glass）的历史相似性。
        *   是否陷入"复杂的解决方案"陷阱。
        *   是否在解决一个"虚假代理问题"。
    4.  **最终预测**: 基于上述匹配，给出加权预测。

    **输出格式 (必须是严格的JSON)**:
    {
      "blue_team_analysis": { ... },
      "red_team_analysis": { ... },
      "pattern_matching_analysis": {
        "success_signals": { ... },
        "failure_signals": { ... }
      },
      "final_prediction": {
        "scores": {
            "rational_viability_score": <float>,
            "irrational_breakout_score": <float>
        },
        "recommendation": "<DIAMOND | HIDDEN GEM | LOTTERY TICKET | FLAWED | DULL>",
        "prediction_summary": "<最终中文预测>"
      }
    }
    ```

---

## `[2025-06-30]` Feature 8: 评估模型的哲学性重构 (思想引爆点)

### 状态: ✅ 核心功能实现

-   **关键成就**:
    -   **评估框架重塑**: 响应用户对评估模型"随机性大、过于简陋"的反馈，对第二阶段(深度评估)的核心评估逻辑进行了一次彻底的、哲学层面的重构。
    -   **双重视角引入**: 确认了单一维度的评估(纯技术或纯市场)存在根本性缺陷。最终确立了融合**"内核品质 (Core Quality)"**与**"引爆势能 (Ignition Potential)"**的双重视角评估体系。
    -   **V7.0 "思想引爆点"模型**: 设计并实装了最终的V7.0评估指令。该指令要求AI从8个维度(独创性、重要性、优雅性、文化势能、情感挂钩、模因媒介、叙事简洁度、X因子)进行综合评估，使其既能理解技术项目的内在价值，也能预判非技术类创意的传播潜力。
    -   **模型验证**: 通过对技术项目 (`gofiber/fiber`) 和创意产品 (`a-light-for-cat`) 的实战测试，证明了V7.0模型具备高度的适应性、深刻的洞察力以及辩证的分析能力，成功解决了先前版本的核心缺陷。

-   **核心技术细节: V7.0 Prompt**
    ```
    **V7.0 深度评估指令："思想引爆点"综合评估框架**

    **角色**: 你是全球最顶级的早期概念评估师，融合了技术哲学家的深度、顶级VC的锐利和病毒式营销专家的直觉。你的任务是对一个"想法"进行一次终极的、全方位的评估，既要解构其内在的思想品质，也要预测其在外在世界中的引爆潜力。
    **核心理念**: 一个伟大的想法，必须既有深刻的"内核"，也有点燃世界的"引信"。我们同时评估这两者。

    **评估框架：双视角八维度综合评估**
    你必须从以下两个独立但互补的视角，对这个想法进行评估，并在每个维度上给出 0-10 分的评分：

    **视角一：内核品质 (Core Quality) - 这个想法本身有多好？**
    1.  **O - 独创性 (Originality)**: 它在多大程度上是一个"新的思想"？
    2.  **S - 重要性 (Significance)**: 如果完美实现，它创造的"价值"或"改变"有多大？
    3.  **E - 优雅性 (Elegance)**: 它的内在结构有多么简单、巧妙和优美？

    **视角二：引爆势能 (Ignition Potential) - 这个想法有多大概率能火？**
    4.  **C - 文化势能 (Cultural Momentum)**: 它是否踏在了当前文化潮流的浪眼上？
    5.  **E - 情感挂钩 (Emotional Hook)**: 它触动的是哪一种人类底层情感？有多强烈？
    6.  **M - 模因媒介 (Meme Medium)**: 它的"产出物"本身，是否就是一个易于传播的社交媒介？
    7.  **S - 叙事简洁度 (Story Simplicity)**: 向一个外行人解释清楚这个想法，需要多长时间？

    **最终综合评估**
    8.  **X - X因子/意外惊喜 (X-Factor)**: 综合以上所有，这个想法是否存在一些难以量化，但可能带来巨大成功的"意外因素"？

    **输出格式 (必须是严格的JSON)**:
    {
      "core_quality": { ... },
      "ignition_potential": { ... },
      "x_factor_score": <float>,
      "overall_score": <float>,
      "recommendation": "<DIAMOND (钻石级) | HIDDEN GEM (璞玉) | LOTTERY TICKET (彩票) | PASS (略过)>",
      "final_analysis": "<最终中文论述>",
      "keywords": [...]
    }
    ```

---

## `[2025-06-30]` Feature 7: 系统优化与大规模验证

### 状态: ✅ 稳定且已验证

-   **关键成就**:
    -   **基础设施强化**: 彻底解决了所有关键的基础设施问题，包括通过实施稳健的代理支持解决了网络连接问题，以及通过升级到 `gemini-2.5-flash` 生产模型解决了 Gemini API 的速率限制问题。
    -   **大规模测试**: 成功处理了超过500个项目的批处理，验证了系统在大量负载下的性能、稳定性和吞吐量。系统在初始筛选阶段平均每个项目耗时约0.32秒。
    -   **AI质量验证**: 确认 `gemini-2.5-flash` 模型提供高质量、细致入微的分析，能够准确识别有潜力的项目，同时过滤掉低质量或不相关的内容。
    -   **端到端管道确认**: 完整的三个阶段(筛选、评估、市场洞察)在多个项目上成功执行，证明了架构的正确性和数据流的完整性。
-   **系统状态**: 后端现在是一个生产就绪的智能分析平台，能够以高准确性和可靠性处理大量数据。

---

## `[2025-06-30]` Feature 6: 市场洞察 (阶段 3)

### 状态: ✅ 稳定且已验证

-   **关键成就**:
    -   **`MarketService` 实现**: 创建了 `app/services/market_service.py` 来处理外部市场分析，包括模拟的网络搜索和由AI驱动的竞争分析。
    -   **AI驱动的关键词提取**: 增强了 `AnalysisService`，增加了一个方法，可以从项目的深度评估结果中智能地提取相关的市场搜索关键词。
    -   **完整的三阶段工作流**: 将市场洞察阶段集成到 `OpportunityService` 中，创建了完整的数据流：**筛选 -> 深度评估 -> 市场洞察**。
    -   **CLI增强**: 添加了专用命令 (`market-analysis`, `show-market-projects`) 和更新了统计数据以反映新的分析阶段。
-   **解决的挑战**: 通过迭代简化和改进分析提示，成功解决并处理了多个Gemini API安全过滤器的阻断问题。

---

## `[2025-06-30]` Feature 5: 深度评估 (阶段 2)

### 状态: ✅ 稳定且已验证

-   **关键成就**:
    -   **README分析**: 增强了 `AnalysisService`，使其能够对有潜力的项目的 `README` 内容进行深入分析。
    -   **结构化评分**: AI 现在返回一个结构化的JSON对象，其中包含对 `business_score`, `technical_score`, `market_score`, 和 `overall_score`
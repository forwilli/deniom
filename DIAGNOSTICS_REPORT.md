# Deniom 项目诊断与重构计划 (v1.1)

**诊断师**: Gemini 2.5 Pro
**更新日期**: 2025-07-07

---

## 1. 诊断报告：当前核心问题

本报告基于对项目代码库和架构规范的全面审查，识别出以下核心技术债务和风险。

### 1.1 基础设施

- **[已解决]** **环境未初始化**: Python 虚拟环境未创建，依赖未安装。
- **[已解决]** **版本控制缺失**: 项目未初始化为 Git 仓库。

### 1.2 后端 (02backend)

- **[已解决]** **服务层职责模糊**: 业务逻辑过度集中于单一文件。
- **[已解决]** **文件组织结构偏离**: `projects` 模块未在 `features` 目录下。
- **[已解决]** **客户端层逻辑过重**: `AnalysisClient` 承担了过多的业务逻辑。

### 1.3 前端 (03frontend)

- **[风险等级：高] "上帝对象"污染共享层**:
  - **问题**: `opportunity-card.tsx` 和 `opportunity-detail.tsx` 等包含复杂业务逻辑的组件被错误地放置在共享的 `src/components/` 目录。
  - **影响**: 严重违背FSD原则，破坏了功能切片的封装性，导致共享层腐化。

- **[风险等级：高] "上帝页面"组件**:
  - **问题**: `src/app/page.tsx` 文件极其臃肿 (437行)，集成了状态管理、数据处理、业务逻辑和内联组件定义。
  - **影响**: 违背了FSD"轻量路由层"原则，导致代码高度耦合，难以复用和测试。

- **[风险等级：中] 数据获取逻辑混乱**:
  - **问题**: 数据获取逻辑分散在共享层 (`lib/hooks`) 和功能层 (`features/project-list/hooks`)。
  - **影响**: 造成数据来源不统一，增加了维护的复杂性。

---

## 2. 整体规划：伟大重构 (The Great Refactoring)

为解决上述问题，我们将启动一项统一的重构计划，目标是：

- **债务偿还**: 系统性地解决已识别的技术债务。
- **回归正轨**: 使前后端实现严格对齐既定的架构规范。
- **提升健康度**: 显著提高代码的可读性、可维护性和可扩展性。

此计划将并行推进后端服务层重构与前端组件化重构。

---

## 3. 后续步骤：行动清单

以下是立即需要执行的任务清单。我将根据我们的对话持续更新此列表的状态。

-   `[x]` **(基础)** `infra-setup-git`: 初始化项目为 Git 仓库。
-   `[x]` **(后端)** `backend-refactor-services`: 重构服务层，将逻辑拆分到 `src/services/` 下的多个专用服务中。
-   `[x]` **(后端)** `backend-refactor-structure`: 调整文件结构，将 `src/projects` 移动到 `src/features/projects`。
-   `[x]` **(前端)** `frontend-refactor-components`: 清理共享组件，将业务组件 `opportunity-*` 归位到其功能切片中。 (由 Gemini 2.5 Pro 于 2025-07-07 完成)
-   `[x]` **(前端)** `frontend-refactor-page`: 对 `page.tsx` 进行瘦身，将业务逻辑和内联组件抽取到 `project-list` 功能切片。 (由 Gemini 2.5 Pro 于 2025-07-07 完成)
-   `[x]` **(前端)** `frontend-refactor-dataflow`: 统一前端数据流，将数据获取逻辑全部收敛到功能切片内部。 (由 Gemini 2.5 Pro 于 2025-07-07 完成)
-   `[ ]` **(收尾)** `final-review`: 在所有重构完成后，进行最终的回归检查和架构符合性验证。 
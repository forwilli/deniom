# Deniom 统一产品架构 (v2.0)

本文档定义了 Deniom 项目从 "Phase 2: 交互式情报平台" 开始的核心架构设计与技术规范。它是所有后续开发工作的统一准则，并整合了旧的 `logic.md`。

## 1. 核心定位与理念

### 1.1 产品定位
**Deniom** 是一个 **"决策情报平台 (Decision Intelligence Platform)"**，提供两大核心服务：

1. **📊 智能情报服务**: 自动发现、分析并展示最新的技术供给和市场需求，为用户提供高质量的商业机会情报。
2. **🔍 想法验证引擎**: 运用成熟的四阶段分析流程，为用户的创业想法提供专业的审核报告和实现方案。

### 1.2 设计理念
-   **自动化优先**: 核心分析流程完全自动化，无需用户手动触发。
-   **前后端分离**: 严格分离后端 API 和前端应用。
-   **服务化架构**: 后端逻辑拆分为高内聚、低耦合的服务。
-   **数据驱动**: 所有架构决策都为增强数据价值服务。
-   **容错设计**: 系统必须能够从处理过程中的任意失败点恢复。
-   **AI 规则驱动开发**: 项目开发 **必须** 遵循 `.cursor/rules/` 中定义的上下文感知规则。

## 2. 总体文件结构

```
/
├── 01base/             # 项目核心文档与统一视图
│   ├── ARCHITECTURE.md
│   ├── backend_log.md  (-> symlink)
│   └── frontend_log.md (-> symlink)
├── 02backend/          # 后端 FastAPI 应用
│   ├── backendlog.md   # 后端开发日志 (源文件)
│   ├── .cursor/
│   │   └── rules/      # 后端专属规则
│   └── ...
├── 03frontend/         # 前端 Next.js 应用
│   ├── frontendlog.md  # 前端开发日志 (源文件)
│   ├── .cursor/
│   │   └── rules/      # 前端专属规则
│   └── ...
├── .cursor/
│   └── rules/          # 全局架构与开发铁律
└── .gitignore
```

## 3. 后端架构 (`02backend/`)

### 3.1 核心技术栈
-   **框架**: **FastAPI**，用于构建高性能、异步的 RESTful API。
-   **数据库**: **SQLite**，通过 **SQLModel** 进行数据建模和交互。
-   **任务调度**: **APScheduler** 或类似工具，实现定时自动分析。

### 3.2 双服务架构

#### 服务A: 智能情报服务
-   **核心业务逻辑**: 严格遵循 **"四阶段金字塔分析模型"**:
    1.  **宽基筛选**: 使用轻量级 AI 从大量项目中快速筛选。
    2.  **深度评估**: 对初筛项目进行基于 `README` 的深度内在价值分析。
    3.  **市场洞察**: 结合网络搜索，评估项目的外部市场与竞争环境。
    4.  **顶尖合成**: 使用最高阶 AI 横向对比，提炼出当日最佳机会。
-   **自动化机制**: 通过定时任务每日自动执行完整分析流程。

#### 服务B: 想法验证引擎
-   **输入**: 用户提交的创业想法描述。
-   **处理**: 运用同样的四阶段分析模型进行专业分析。
-   **输出**: 结构化的验证报告。

### 3.3 服务层架构 (Service-Oriented Architecture)
-   `opportunity_service.py`: **智能情报服务编排器**，管理自动化分析流程。
-   `idea_validation_service.py`: **想法验证服务编排器**，处理用户想法验证请求。
-   `github_service.py`: 唯一负责与 GitHub API 的所有交互。
-   `market_service.py`: 唯一负责执行外部网络搜索。
-   `analysis_service.py`: 唯一负责执行所有对 LLM (Gemini) 的调用。

### 3.4 API 端点设计

#### 智能情报API (`/api/v1/opportunities/`)
- `GET /` - 获取机会列表（分页、排序、筛选）
- `GET /{id}` - 获取项目详情
- `POST /{id}/vote` - 投票
- `POST /{id}/comments` - 评论

#### 想法验证API (`/api/v1/ideas/`)
- `POST /validate` - 提交想法进行验证
- `GET /{id}/report` - 获取验证报告

## 4. 前端架构 (`03frontend/`)

### 4.1 技术栈
-   **框架**: **Next.js 14** (App Router) + **TypeScript** + **Tailwind CSS**。
-   **状态管理**: **React Query** (`@tanstack/react-query`) 用于服务端状态管理。
-   **设计系统**: 现代化白色背景 + 无卡片丝滑列表设计。

### 4.2 页面架构

#### 主页面 (`/`)
-   **顶部模块**: "验证想法"入口。
-   **智能情报展示区**: 无缝双列布局，展示已分析的项目和需求。
-   **交互功能**: 投票、评论、排序、筛选。

#### 项目详情页 (`/project/[id]/`)
-   **完整分析展示**: 四阶段分析结果的详细呈现。
-   **用户交互**: 投票、评论功能。

## 5. 开发与AI协作规范

所有开发活动 **必须** 严格遵守 `.cursor/rules/` 目录中定义的规则。这些规则是项目的"活文档"和"开发宪法"，为 AI 提供了上下文感知的指导。

- **全局规则 (`/.cursor/rules/`)**: 定义了项目通用的顶层架构、命名规范和版本控制策略。
- **后端规则 (`/02backend/.cursor/rules/`)**: 当编辑后端代码时自动生效，约束 API 设计、数据库交互和服务架构。
- **前端规则 (`/03frontend/.cursor/rules/`)**: 当编辑前端代码时自动生效，规范组件化、状态管理和样式系统。

## 6. 日志与文档管理

为了兼顾**物理分离**与**逻辑统一**，我们采用符号链接（Symbolic Link）方案来管理开发日志。

- **源文件**: `backendlog.md` 和 `frontendlog.md` 的真实文件分别存放在 `02backend/` 和 `03frontend/` 目录中。开发人员应直接更新这些源文件。
- **统一视图**: `01base/` 目录中包含指向这些源文件的符号链接。这为项目架构师提供了一个无需离开核心文档目录即可审查前后端进度的统一视图。

---

*最后更新: 2025-06-30*
*架构师: Gemini 2.5 Pro* 